<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Course Project Blog – Ben Little</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="wrapper">
      <header>
        <h1>About this Project</h1>

        <p><em>Stardew Assistant</em> is a quality-of-life mod for Stardew Valley that improves the gameplay experience without 
            changing the game’s core balance. It includes a nightly diary prompt, smarter shopping tools, and bundle tracking features, 
            all designed to help players make more informed decisions, remember their goals, and reduce repetitive tasks.
            </p>

        <p>For more information, you can read the full project proposal <a href="ProfDev Project Proposal.pdf" target="_blank">here!</a></p>

        <p>Or additional info can be found on the project specific <a href="https://github.com/BenLittle24/Stardew-Assistant">GitHub.</a></p>
      </header>

      <section>
        <h2>Course Project Blog</h2>

        <h2>June 12 – Getting Started and Writing Proposal</h2>
        <p>Without a doubt, I did not hit the ground running in this course and had a busy week making up for it. 
            I considered several project ideas, overthought minor details at every opportunity, but did eventually settle on an idea 
            I’m reasonably happy with. Once the hard part was done, I wrote and submitted the project proposal. 
            Open-ended or self-defined projects generally give me analysis paralysis, so committing to an idea and writing 
            the proposal is somewhat of a relief.
            </p>

 

        <p>As for next week, I need to familiarize myself with SMAPI and build/run a small mod as a proof of concept. 
            I think anything modifying the UI directly will be too large of a leap, but I think I could add or alter an event 
            to trigger a part of the game’s existing UI, like the mail delivery, to get my feet wet. In the most technical terms, 
            I could slide into my own DMs with a proof of concept message that confirms the mod can access and respond to game events. 
        </p>
 

        <p>To do so, I’ll need to understand and edit the mail related game events so that some preexisting game event, 
            or a game event I create, sends me mail when it otherwise wouldn’t. I think this will be a good proof of concept, 
            all of my planned QoL improvements will need to be triggered by in-game events. 
        </p>
 

        <p>I expect the biggest impediments at this point will be the size of the codebase I’m trying to work with 
            and my unfamiliarity. I also expect some growing pains in setting up the development environment.</p>

        <h2>June 19 – Website Creation and Research</h2>
        <p>Last week, I set up my personal website, which turned out to be more challenging and engaging 
          than I expected. Like many others, I used GitHub pages and started with pretty simple functionality. 
          Without a doubt there is room for improvement, but I'm satisfied with where it stands for now. </p>

        <p>Apart from that, I started exploring Stardew's codebase and some of the SMAPI documentation. 
          I'll admit I'm more than a bit behind where I hoped to be, but I think I made good use of the time I had. 
          It wasn't the most productive, but I spent some time sharpening the saw and I hope this will save time 
          later on. I definitely underestimated how long the ramp up would take too, the saw was dull. </p>

        <p>My goals for next week haven't changed much, I still want to build a simple proof of concept feature 
          that responds to an in game event. Once that's working, I'll move on to the EOD diary prompt and UI. 
          I hope that the time spent exploring and getting familiar with the codebase will pay off and 
          save time in the future. </p>

        <p>I'm not aware of any major blockers, just the usual cocktail of limited time, other responsibilities, 
          and trying to build something I'm still figuring out how to build. </p>


        <h2>June 26 – Setting up Environment and Proof of Concept</h2>
        <p>While I don’t think last week was a waste of time, I made more tangible progress this week. I was able to set up my dev environment, find and customize a SMAPI mod template to work successfully enough for a proof of concept, and got a decent start on the EOD diary entry. </p>

        <p>The dev environment was the first challenge, and I wonder how much of it was because I’m using macOS. I’ve used Wine and Bootcamp previously to work with Windows programs, but used Mono and .NET SDK to work with Stardew’s older .NET framework here. I needed Mono to build .NET Framework projects on macOS since, as I understand it, Stardew and SMAPI both require .NET Framework 4.5. Then I installed .NET SDK with Homebrew to get access to dotnet build to build my mod. 
</p>
        <p>After that I started working with the mod template, which was just a community SMAPI mod template I cloned from GitHub. This was helpful as it was a working starting point with the right structure, basic config files, and build settings, but I did have to modify manifest.json and .csproj files to target net45 and produce clean and singular build output files.
</p>
        <p>From there I made the first, very basic mod and confirmed that it could load in game. As a test, I had it log a message in the SMAPI console and write a line to diary.txt at the end of the day, which worked! I did initially plan on sending myself in game mail as the proof of concept, but decided that the end of day event would be easier to hook into, compared to a mail game event that is less frequent and harder to predict, or would require additional work to trigger intentionally. 
</p>
        <p>With my concept proven, I started experimenting with showing a diary prompt for the user to add a custom entry. I used the existing NamingMenu game UI, which, for the uninitiated, is typically used to give animals a name. I’ll have to expand or improve on this at some point, but it works well for this stage of development. 
</p>
        <p>I tried a couple of event hooks like DayEnding, DayStarted, and Saving, but these either didn’t work or blocked game progression. DayStarted is the best approach so far, and does save the diary entry without the player needing to progress to the next save point, even though this occurs after game save. So on the bright side, if I made an entry it was being saved in diary.txt, but I couldn’t move past the diary entry after completing it. I also made it so that if the entry field was blank, nothing would save to diary.txt, so the diary won’t be cluttered with empty entries. </p>
        
        <p>For next week, there are a few known issues I’d like to fix. Unsurprisingly, the main goal is to rework the diary prompt so it doesn’t stall the game. Using DayStarted is my most recent approach and I haven’t had the time to identify the cause of the problem yet. Then the UI for the diary entry is less than ideal, it’s too small and has a character limit. 
</p>
        <p>Once the diary entry feature is usable, I’ll start to focus on in-game retrieval, which brings up another issue. Currently, diary.txt is not save file specific, so diary entries from any save file are stored in a single diary.txt file. This will definitely need to be addressed, but is not a high priority at this time. 
</p>
        <p>For impediments, figuring out the right time to show the UI without breaking the game and with a functional diary entry has been tricky. I’ve been doing a lot of trial and error, which can be time consuming. But getting the environment set up and confirming the mod could load with some degree of functionality was a big step. 
</p>

        <h2>July 3 – Diary Entry Prompt Progress</h2>
        <p>Last week, my main focus was fixing and improving the diary prompt functionality and UI, and I made some significant progress. The most pressing issue was that the diary prompt was blocking the game from progressing. While I thought this was going to be a challenge, it was actually simpler than expected, I just didn’t understand the cause of the issue. I spent some time barking up several wrong trees before realizing that the NamingMenu UI I was adapting didn’t properly exit the active menu when the OK button was pressed, allowing the game to continue. My adapted menu had all the other functionality from its original use, but not this, which was a surprise. Thankfully, it wasn’t a difficult fix after figuring this out. 
</p>
        <p>From there, I started working on an improved UI for the diary entry. The NamingMenu was good for testing the game event hooks and diary entry saves, but has a small window and character limit. I started experimenting with making my own custom UI, but this has been a challenge. One issue is that pressing hotkeys while typing the entry will close the prompt. For example, when typing “test,” pressing “e” would open the inventory and close the prompt, leaving the saved diary entry as “te.” I was able to fix the input capture so that typing works as expected, but the visual layout still needs some polishing. 
</p>
        <p>Next week, I hope I can finish the UI for the diary entry and transition to recalling past diary entries in game. Currently, all diary entries are just in a diary.txt file. With this, I’ll need to make diary entries save file specific so that the in-game recall only shows entries from that specific save file. 
</p>
        <p>I’m not aware of any major impediments apart from the constants like time constraints and lack of knowledge, but I think I worked through these well this past week and hope to continue. That said, I don’t feel I have a solid plan on how to make the diary entries save file specific and recall them in-game. I think I can probably build off of existing game features like the quest journal, but there is a lot to learn before I can attempt this. 
</p>

        <h2>July 10 – Prioritizing Family</h2>
        <p>Last week wasn’t as productive as I’d hoped. Unfortunately, I had to travel due to a family emergency, so project work took a backseat. That said, I did spend some time thinking about the diary entry UI and have another approach to explore. 
        </p>

        <p>So far, I’ve been building the UI from scratch and adapting the naming menu, but I remembered that Stardew does allow players to add text to in-game signs. I haven’t looked into this system yet, or even used it in the game, but I think it might be an easier way to handle player text input. At the very least, it’s worth looking into and could simplify the UI issues I’ve been dealing with. 
        </p>

        <p>For this week, I have the same goals as last week, but with the new idea of building off of the sign text entry UI. My impediments are the same as well, plus playing some catch up. 
        </p>

        
         <h2>July 17 – Persistant UI Issues</h2>

         <p>This week I pulled out a considerable amount of my hair working on the diary entry UI. The issues are that the text isn’t properly aligned in the text box, the text isn’t wrapping after the first line, and the larger text entry field is a different color than the first line where I can actually enter text. I did experiment with using the text entry used for adding text to signs, but I don’t believe this approach will solve any of the issues I’m working on. I do think I’ve figured out the root cause of the issue. 
         </p>

         <p>Basically, this is all due to the games built in TextBox, which is designed for a single line of text and has a fixed height background. This means if I try to expand it like my current implementation, the text appears stuck to the top of the box. I’ve tried adjusting the TextBox position and offset to center the TextBox in the background, but this still looks off (so far). I need to experiment more with drawing a custom background for the text area to hopefully solve this, but I haven’t been able to match the color to the rest of the menu yet, so there are still seams visible. 
         </p>

         <p> Multi line text or text wrapping is not supported by the vanilla TextBox either, and I think this might be a bigger challenge than the other UI issues. There is a mod, Dear Diary, that implements text entry exactly as I would like to, but I need to spend more time looking through it. The code itself doesn’t seem to be available, but I didn’t look too hard to avoid the temptation of working off of their implementation. It does seem like they went through multiple iterations of the UI code with help from experienced modders, and that the UI had to be heavily modified for it to work. While this is validating, it also suggests that creating multi line text input requires custom logic. 
         </p>

         <p>For next week, I’m torn between continuing work on the diary entry UI and starting work on another feature. On one hand, the diary entry UI issues are fresh in my mind, but on the other, I feel I might have tunnel vision around this, and time away might help me return to it with a fresh perspective. 
         </p>

         <p>My impediments are the limitations of the built-in TextBox, I’ve already spent too much time working on this aspect of the project and it has slowed progress considerably. Additionally, every test of the UI requires building the mod files, loading the game, and ending the in-game day to evaluate the changes I’ve made. While this doesn’t seem too time consuming, it certainly adds up. 
         </p>



         <h2>July 31 – UI Breakthrough</h2>

         <p>This week felt like a significant leap forward for the diary entry feature! It’s finally starting to behave like the proper multiline text box I envisioned. To recap, I had been running into UI layout and text wrapping issues and was considering scrapping the built in text entry system I had started with. In hindsight, the built in text entry worked well as a proof of concept for hooking into save events, presenting the prompt, and confirming that the diary entries were saved, but it came with limitations that made adapting it to my goals difficult. To be fair, I think it’s possible, but the amount of workaround seemed prohibitive. In the most technical terms, I’m not sure the juice is worth the squeeze. </p>

         <p>Instead, I started building a custom input and rendering system, which has been working surprisingly well, but is not without issues. For the text wrapping, I tried using a manual, per character routine that breaks lines when they exceed the set text area’s width. This is functional, and solves the problem of long strings running off of the edge of the text entry field, but the per character line wrapping method is a stand in while I work on per word line wrapping. As it stands now, a new line will happen whenever the max text width is exceeded, but with no consideration for where the line breaks. It’s nostalgic in a way, I haven’t seen text wrapping like this since my early memories of the internet. </p>

         <p>With this change came another frustrating but familiar issue: pressing certain keys (hotkeys) during text entry would trigger in game actions and close the diary prompt. For example, typing “test” would open the inventory and cancel the menu as soon as you hit “e.” The conflicts happened because the game is still listening for global hotkeys, even while the diary text box was active. To fix this, I changed how the game handles keyboard input while the diary is open as I had done in the past. </p>

         <p>Currently, the main issue preventing me from moving forward is that the text entry doesn’t properly support deleting characters. I can’t remove text once it’s been typed, which makes editing mistakes or revising a sentence impossible. Fixing this issue is my top priority before I move on to other features.</p>


         <h2>August 7 – UI Finetuning and Success</h2>

         <p>Last week I finetuned the diary entry UI and it’s finally behaving in a way that I am satisfied with! The main changes were the line wrapping, backspace functionality, and adding a header prompt. For the line wrapping, I changed to word boundary wrapping so words won’t split mid line. 
</p>

        <p>With the backspace functionality, the issue was that pressing the key wasn’t doing anything in the text entry. The cause was that the key press wasn’t passing through properly, it was being treated like a hotkey, which I previously blocked while the diary entry prompt was open to fix a different issue. I forgot that backspace was a hotkey at the time, but with this change, backspace removes characters as expected during text entry. 
</p>

        <p>Finally, I added a small header prompt. Initially, I had guessed and checked the header height, but ended up measuring the header text and pushing the input area down by the same amount for clean spacing.

        </p>

        <p>For the coming week, I’m a little torn on where to start. One option is that I need an in-game viewer for past diary entries, which I envision as something similar to the quest journal, where the player can click an icon to open a list of past entries sorted by entry date. From there, the player can click on individual entries to expand them. To do this, I’ll need to read and parse diary.txt, where all entries are currently saved.
</p>

        <p>The other option/issue is that diary.txt is global at the moment, not save file specific. This means that entries from different farms or test saves all get mixed together, and I don’t know of a clean way to filter them in game. So do I start working on the UI first, or the data first? 
</p>

        <p>With UI first, I’d build the in-game viewer using the current global diary.txt file, which I think would give a faster, demo ready proof of concept. I would still need to update the saving system later though, and while I don’t expect I would need to completely rework the viewer, I don’t know how much adaptation might be needed after changing the saving system. 
</p>

        <p>On the other hand, I could work on the data first and avoid the reworking/adaptation of the viewer, it would be aligned with or built off of the final structure from the start. I wouldn’t be able to demonstrate the functionality until the new storage system was in place though, which is a consideration.
</p>

        <p>I’m open to any input! This is my main impediment at the moment. If time wasn’t a factor, I would work on the saving system first and then move on to the viewer UI, but we’re close to the end of the project and I’d like to have something to show off, even if it isn’t strictly necessary. 
</p>

~ </p>


      </section>

      <footer>
        <p>Hosted on GitHub Pages — Theme by <a href="https://github.com/orderedlist/minimal">orderedlist</a></p>
      </footer>
    </div>
  </body>
</html>
